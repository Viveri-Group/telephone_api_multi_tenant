<?php

namespace Tests\Feature\API\Competition\IsOpen;

use App\Models\Competition;
use Illuminate\Support\Carbon;
use PHPUnit\Framework\Attributes\DataProvider;
use Tests\TestCase;

class CompetitionWholeIsOpenTest extends TestCase
{
    #[DataProvider('isOpenDataProvider')]
    public function test_competition_is_open_works_as_expected(string $dateNow, string $startDate, string $endDate, bool $expectedIsOpen)
    {
        Carbon::setTestNow($dateNow);

        $competition = Competition::factory()->create([
            'start' => $startDate,
            'end' => $endDate,
        ]);

        if ($expectedIsOpen) {
            $this->assertTrue($competition->isOpen);
        } else {
            $this->assertFalse($competition->isOpen);
        }
    }

    public static function isOpenDataProvider(): array
    {
        return [
            'competition is open - between date' => [
                'dateNow' => '2024-01-04 12:15:00',
                'startDate' => '2024-01-01 15:10:00',
                'endDate' => '2024-01-31 15:00:00',
                'expectedIsOpen' => true
            ],
            'competition is open - 1 min after opening' => [
                'dateNow' => '2024-01-01 15:11:00',
                'startDate' => '2024-01-01 15:10:00',
                'endDate' => '2024-01-31 15:00:00',
                'expectedIsOpen' => true
            ],
            'competition is open - 1 min before close' => [
                'dateNow' => '2024-01-31 14:59:00',
                'startDate' => '2024-01-01 15:10:00',
                'endDate' => '2024-01-31 15:00:00',
                'expectedIsOpen' => true
            ],


            'competition is closed - wrong month' => [
                'dateNow' => '2024-02-01 09:00:00',
                'startDate' => '2024-01-01 15:10:00',
                'endDate' => '2024-01-31 15:00:00',
                'expectedIsOpen' => false
            ],
            'competition is closed - early by 1 minute' => [
                'dateNow' => '2024-01-01 15:09:00',
                'startDate' => '2024-01-01 15:10:00',
                'endDate' => '2024-01-31 15:00:00',
                'expectedIsOpen' => false
            ],
            'competition is closed - late by 1 minute' => [
                'dateNow' => '2024-01-31 15:01:00',
                'startDate' => '2024-01-01 15:10:00',
                'endDate' => '2024-01-31 15:00:00',
                'expectedIsOpen' => false
            ]
        ];
    }


}
